<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MindEase AI - ChatGPT Style</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://kit.fontawesome.com/6a8e2a7a7d.js" crossorigin="anonymous"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"Poppins",sans-serif;}
body{height:100vh;display:flex;justify-content:center;align-items:center;background:#f5f1e8;}
.background-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#f9f7f3 0%,#f3ede2 40%,#e9dcc5 100%);z-index:-2;}
.layout{display:flex;width:95%;max-width:1400px;height:90vh;border-radius:25px;background:rgba(255,255,255,0.6);backdrop-filter:blur(25px);box-shadow:0 10px 35px rgba(0,0,0,0.15);overflow:hidden;}
.sidebar{width:280px;background:rgba(255,255,255,0.4);border-right:1px solid rgba(0,0,0,0.08);display:flex;flex-direction:column;padding:25px;color:#2b2b2b;}
.logo{display:flex;align-items:center;gap:10px;margin-bottom:20px;}
.logo h1{font-size:1.3rem;font-weight:600;color:#2b2b2b;}
.logo span{color:#b29b80;}
.sidebar-btn{display:flex;align-items:center;gap:10px;background:#f5f1e8;border:none;color:#2b2b2b;font-weight:500;padding:10px 15px;border-radius:12px;margin-bottom:10px;cursor:pointer;transition:all 0.3s ease;box-shadow:0 2px 6px rgba(0,0,0,0.05);}
.sidebar-btn:hover{background:#e9dcc5;transform:translateY(-2px);}
.chat-history-list{margin-top:10px;overflow-y:auto;flex:1;}
.chat-thread{padding:8px 10px;border-radius:10px;margin-bottom:5px;cursor:pointer;background:#f5f1e8;transition:0.2s;}
.chat-thread:hover{background:#e9dcc5;}
.chat-thread.active{background:#d0c0a0;}
.chat-area{flex:1;display:flex;flex-direction:column;color:#2b2b2b;position:relative;}
.chat-header{padding:18px 20px;border-bottom:1px solid rgba(0,0,0,0.08);text-align:center;font-weight:500;letter-spacing:0.5px;color:#4a4a4a;background:rgba(255,255,255,0.5);}
.chat-box{flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:12px;}
.chat-message{max-width:70%;padding:12px 16px;border-radius:15px;word-wrap:break-word;font-size:0.95rem;animation:fadeIn 0.4s ease;}
.chat-message.user{align-self:flex-end;background:#e8dfd4;color:#2b2b2b;box-shadow:0 3px 6px rgba(0,0,0,0.05);}
.chat-message.bot{align-self:flex-start;background:#fdf6ed;color:#2b2b2b;box-shadow:0 3px 6px rgba(0,0,0,0.05);}
.chat-form{display:flex;align-items:center;padding:15px 20px;border-top:1px solid rgba(0,0,0,0.08);background:rgba(255,255,255,0.7);}
.chat-form input{flex:1;border:none;background:rgba(255,255,255,0.6);padding:12px 15px;border-radius:25px;color:#2b2b2b;outline:none;font-size:1rem;}
.chat-form input::placeholder{color:#8b7d6b;}
.chat-form button{background:#b29b80;border:none;border-radius:50%;width:45px;height:45px;margin-left:10px;color:#fff;font-size:1.1rem;cursor:pointer;transition:all 0.3s ease;}
.chat-form button:hover{background:#9b886e;}
.file-upload{margin-right:10px;color:#8b7d6b;cursor:pointer;font-size:1.2rem;}
.feature-btn{display:block;margin:5px 0;background:#f5f1e8;border:none;padding:6px 12px;border-radius:8px;cursor:pointer;transition:0.2s;}
.feature-btn:hover{background:#e9dcc5;}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px);}to{opacity:1;transform:translateY(0);}}

/* Small visual hint for supportive prompt */
.bot-prompt { font-weight:600; font-size:0.95rem; opacity:0.95; }
</style>

</head>
<body>
<div class="background-overlay"></div>
<div class="layout">

<aside class="sidebar">
    <div class="logo"><h1>MindEase <span>AI</span></h1></div>
    <button id="newChatBtn" class="sidebar-btn"><i class="fa-solid fa-plus"></i> New Chat</button>
    <button id="exportChatBtn" class="sidebar-btn"><i class="fa-solid fa-download"></i> Export Chat</button>
    <button id="clearHistoryBtn" class="sidebar-btn"><i class="fa-solid fa-trash"></i> Delete All History</button>
    <div class="chat-history-list" id="chatHistory"></div>
</aside>

<main class="chat-area">
    <header class="chat-header">
        <h2><i class="fa-solid fa-brain"></i> MindEase Assistant</h2>
    </header>
    <div class="chat-box" id="chatBox"></div>
    <form id="chatForm" class="chat-form">
        <label for="fileInput" class="file-upload">
            <i class="fa-solid fa-image"></i>
            <input type="file" id="fileInput" accept="image/*" hidden>
        </label>
        <input type="text" id="userInput" placeholder="Type a message..." autocomplete="off">
        <button type="submit"><i class="fa-solid fa-paper-plane"></i></button>
    </form>
</main>

</div>

<script>
// ---------- DOM references ----------
const chatBox = document.getElementById('chatBox');
const chatForm = document.getElementById('chatForm');
const userInput = document.getElementById('userInput');
const newChatBtn = document.getElementById('newChatBtn');
const exportChatBtn = document.getElementById('exportChatBtn');
const clearHistoryBtn = document.getElementById('clearHistoryBtn');
const fileInput = document.getElementById('fileInput');

let currentChatId = null;
let localMessages = [];

// ---------- Local user ID ----------
window.currentUserId = 'local_user';

// ---------- AI database ----------
const aiDatabase = [
    {mood:'sad',responses:[
        "I’m here with you — you’re not alone.",
        "It’s okay to feel down sometimes. You matter more than you know.",
        "Sometimes just talking helps. Would you like to write a little in your journal?"
    ],suggestion:["journal","doodle","calmingSounds"]},
    {mood:'distressed',responses:[
        "I’m really sorry that you’re in such deep pain right now. You deserve care and safety.",
        "You’re not alone — it’s brave of you to share how you feel. You matter deeply.",
        "This sounds really heavy. Would you like to try a short breathing exercise or write down one thing that’s on your mind?"
    ],suggestion:["breathing","calmingSounds","voiceMemory"]},
    {mood:'stressed',responses:[
        "Take a deep breath — we can handle this together.",
        "Try closing your eyes and exhale slowly. Would you like to do a 1-minute breathing now?",
        "You’ve been trying really hard — remember to give yourself some credit."
    ],suggestion:["breathing","calmingSounds","voiceMemory"]},
    {mood:'happy',responses:[
        "Yay! That’s great to hear!",
        "Your positivity is contagious!",
        "That sounds wonderful — tell me more about what’s making you happy!"
    ],suggestion:["journal","story","doodle"]},
    {mood:'angry',responses:[
        "I hear you, it's okay to feel frustrated.",
        "Let's redirect that energy positively. Would you like to try a quick breathing or a doodle break?",
        "It’s strong of you to express this — maybe we can find a calm way to ease that anger."
    ],suggestion:["journal","breathing","calmingSounds"]},
    {mood:'neutral',responses:[
        "Tell me about your day!",
        "Even quiet moments can be meaningful.",
        "Sometimes just being still can bring peace."
    ],suggestion:["journal","story","calmingSounds","doodle"]}
];

// ---------- Mood detection ----------
function detectMood(text){
    const moodKeywords = {
        happy:[/happy|good|great|excited|fine|awesome/i],
        sad:[/sad|down|depressed|cry|lonely|hopeless/i],
        distressed:[/i want to die|i wanna die|i'm going to die|want to die|kill myself|suicide|end it all|can't go on|can't take this|cant do this/i],
        stressed:[/stressed|tired|pressure|overwhelmed|anxious|panic|overwhelming/i],
        angry:[/angry|mad|furious|irritated/i],
        neutral:[/ok|okay|normal|meh/i]
    };
    for(const mood in moodKeywords){
        if(moodKeywords[mood].some(r => r.test(text))) return mood;
    }
    return 'neutral';
}

// ---------- Feature labels ----------
function getFeatureLabel(f){
    switch(f){
        case "journal": return {label:"🗒️ Write in Journal", action:()=>openJournal(), url:"journal.html"};
        case "breathing": return {label:"🧘 Start Breathing", action:()=>startBreathing(), url:"relaxation-tools.html"};
        case "calmingSounds": return {label:"🎶 Play Calming Sounds", action:()=>openCalmingSounds(), url:"relaxation-tools.html"};
        case "doodle": return {label:"✏️ Open Doodle", action:()=>openDoodle(), url:"doodle.html"};
        case "story": return {label:"📖 Read Motivational Story", action:()=>openStory(), url:"story1.html"};
        case "voiceMemory": return {label:"🎤 Listen to Voice Memory", action:()=>openVoiceMemory(), url:"voice-memories.html"};
        default: return {label:f, action:()=>{}, url:"#"};
    }
}

function openJournal(){ window.open('journal.html','_blank'); }
function startBreathing(){ window.open('relaxation-tools.html','_blank'); }
function openCalmingSounds(){ window.open('relaxation-tools.html','_blank'); }
function openDoodle(){ window.open('doodle.html','_blank'); }
function openStory(){ window.open('story1.html','_blank'); }
function openVoiceMemory(){ window.open('voice-memories.html','_blank'); }

// ---------- Display messages ----------
function displayMessage(msg, sender='bot', features=[]){
    const div = document.createElement('div');
    div.classList.add('chat-message', sender);

    if(sender === 'bot' && msg && msg.toLowerCase().includes('would you')) {
        const p = document.createElement('div');
        p.className = 'bot-prompt';
        p.textContent = msg;
        div.appendChild(p);
    } else {
        div.textContent = msg;
    }

    chatBox.appendChild(div);

    features.forEach(f => {
        const btn = document.createElement('button');
        btn.className = 'feature-btn';
        btn.textContent = f.label;
        btn.onclick = () => {
            try { f.action(); } catch(e){ if(f.url) window.open(f.url,'_blank'); }
        };
        chatBox.appendChild(btn);
    });

    chatBox.scrollTop = chatBox.scrollHeight;
    localMessages.push({sender,text:msg,features:features.map(f=>f.label),timestamp:new Date().toISOString()});
}

// ---------- Bot response ----------
function getBotResponse(userText) {
    const mood = detectMood(userText);

    const distressTriggers = [
        /i want to die/i,/i wanna die/i,/kill myself/i,/suicide/i,/end it all/i,
        /can't go on/i,/cant go on/i,/i can't take this/i,/i cant take this/i,/i'm going to die/i,
        /im going to die/i,/feel like to die/i,/feel like dying/i,/want to end my life/i,/end my life/i
    ];

    const isDistress = distressTriggers.some(rx => rx.test(userText));

    if (isDistress) {
        const msg = "It sounds like things are really heavy right now. You're not alone — you matter, and it's okay to pause for a moment. Would you like to try any of these to ease your mind?";
        const supportiveOptions = [
            getFeatureLabel("breathing"),
            getFeatureLabel("journal"),
            getFeatureLabel("calmingSounds")
        ];
        return { msg, features: supportiveOptions, isDistress: true };
    }

    const overwhelmedRegex = /stressed|pressure|overwhelmed|panic|anxious|too much/i;
    if (overwhelmedRegex.test(userText)) {
        const msg = "Take a deep breath — we can handle this together. Would you like to try a 1-minute breathing exercise or write something in your journal?";
        const features = [
            getFeatureLabel("breathing"),
            getFeatureLabel("journal"),
            getFeatureLabel("calmingSounds")
        ];
        return { msg, features, isDistress: false };
    }

    const entry = aiDatabase.find(e => e.mood === mood) || aiDatabase.find(e => e.mood === 'neutral');
    const msg = entry.responses[Math.floor(Math.random() * entry.responses.length)];
    const features = [];
    if(Math.random() < 0.35){
        const featureKey = entry.suggestion[Math.floor(Math.random() * entry.suggestion.length)];
        features.push(getFeatureLabel(featureKey));
    }
    return { msg, features, isDistress:false };
}

// ---------- Events ----------
chatForm.addEventListener('submit', e => {
    e.preventDefault();
    const msg = userInput.value.trim();
    if(!msg) return;
    displayMessage(msg, 'user');
    userInput.value = '';

    setTimeout(() => {
        const bot = getBotResponse(msg);
        displayMessage(bot.msg, 'bot', bot.features);

        if(bot.isDistress){
            displayMessage("If you're in immediate danger or think you might hurt yourself, please reach out to someone now or call your local emergency number.", 'bot', []);
        }
    }, 350);
});

newChatBtn.addEventListener('click', () => {
    chatBox.innerHTML = '';
    localMessages = [];
    displayMessage("Let's start fresh! How are you feeling today?", 'bot');
});

exportChatBtn.addEventListener('click', () => {
    const text = localMessages.map(m => `${m.sender.toUpperCase()}: ${m.text}`).join('\n');
    const blob = new Blob([text], {type:'text/plain'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url;
    a.download = `mindease_chat_${Date.now()}.txt`; a.click();
    URL.revokeObjectURL(url);
});

clearHistoryBtn.addEventListener('click', () => {
    if(confirm('Delete all chat history?')) {
        chatBox.innerHTML = '';
        localMessages = [];
    }
});

fileInput.addEventListener('change', e => {
    const file = e.target.files[0];
    if(!file) return;
    displayMessage(`You shared an image: ${file.name}`, 'user');
    displayMessage("Nice, this fits your thought!", 'bot');
});

// ---------- Fresh chat on page load ----------
window.addEventListener('load', () => {
    localMessages = [];
    chatBox.innerHTML = '';
    displayMessage("Let's start fresh! How are you feeling today?", 'bot');
});
</script>
</body>
</html>
